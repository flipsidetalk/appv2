var articleText = {"main": [{"agreeable": false, "endParagraph": false, "sentenceId": "a3s0", "text": "Automation may soon affect even industries and jobs we thought were immune, so what should countries do to prepare for those left jobless and behind? ", "seen": false}, {"agreeable": false, "endParagraph": false, "sentenceId": "a3s1", "text": "Bill Gates recently offered a simple solution: Tax the use of robots.", "seen": false}, {"agreeable": false, "endParagraph": true, "sentenceId": "a3s2", "text": "He argues that such a tax would both \u201ctemporarily slow down the spread of automation\u201d and fund social safety net programs for those who lose their jobs to technology.", "seen": false}, {"agreeable": false, "endParagraph": false, "sentenceId": "a3s3", "text": "Gates is not the only one to suggest the idea. ", "seen": false}, {"agreeable": false, "endParagraph": false, "sentenceId": "a3s4", "text": "French presidential candidate Benoit Hamon of the Socialist Party recently proposed a universal basic income partially funded by a robot tax. ", "seen": false}, {"agreeable": false, "endParagraph": true, "sentenceId": "a3s5", "text": "The European parliament also just voted down a proposal to fund support for workers who lost their jobs due to \u201crobotics and AI\u201d through a robot tax.", "seen": false}, {"agreeable": true, "endParagraph": false, "sentenceId": "a3s6", "text": "While it is of vital public policy interest to support technology-displaced workers, the premise of a tax on the use of robots raises several thorny issues.", "seen": false}, {"agreeable": true, "endParagraph": true, "sentenceId": "a3s7", "text": "One is the difficulty of specifying which kinds of robotic automation should be taxed, and more generally, what counts as a robot.", "seen": false}, {"agreeable": false, "endParagraph": false, "sentenceId": "a3s8", "text": "What distinguishes a machine we now accept as integral to economic productivity from a robot whose activity we would wish to tax? ", "seen": false}, {"agreeable": false, "endParagraph": false, "sentenceId": "a3s9", "text": "Washing machines, for example, certainly put many launderers out of work, but they also helped make it possible for millions of women to join the paid workforce.", "seen": false}, {"agreeable": true, "endParagraph": false, "sentenceId": "a3s10", "text": "A robot tax, as Gates proposed, may end up being a tax on innovation and would force Congress and the IRS to make the perhaps impossible distinction between labor-saving machines and labor-enhancing ones. \u00a0", "seen": false}, {"agreeable": false, "endParagraph": false, "sentenceId": "a3s11", "text": "Taxing robots would also fundamentally change the way the United States currently taxes business investment. ", "seen": false}, {"agreeable": true, "endParagraph": true, "sentenceId": "a3s12", "text": "Instead of treating equipment as a depreciating asset for which a firm takes a deduction in computing its taxable income, Gates would single out a subset of these investments for a new tax.", "seen": false}, {"agreeable": false, "endParagraph": false, "sentenceId": "a3s13", "text": "There is also debate among economists over whether robots and automation significantly impacts employment. ", "seen": false}, {"agreeable": false, "endParagraph": true, "sentenceId": "a3s14", "text": "While a report by researchers at Oxford University estimated 54 percent of jobs in the EU are at risk of \u201ccomputerization,\u201d another report by the Organization for Economic Cooperation and Development last year estimated only 9 percent of jobs in 21 OECD countries are automatable.", "seen": false}, {"agreeable": true, "endParagraph": false, "sentenceId": "a3s15", "text": "And although automation certainly has it losers \u2013 the American steel industry lost 75 percent of its work force between 1962 and 2005 \u2013 the creation of new types of jobs and industries may mean that overall employment is not significantly affected.", "seen": false}, {"agreeable": false, "endParagraph": true, "sentenceId": "a3s16", "text": "A recent paper from Georg Graetz of Uppsala University found that industrial robots had no significant effect on overall employment, meaning the total number of hours worked by people in a country stayed around the same even when the use of those devices increased.", "seen": false}, {"agreeable": false, "endParagraph": false, "sentenceId": "a3s17", "text": "For those left permanently behind by the technological revolution, these facts will understandably be of little comfort. ", "seen": false}, {"agreeable": false, "endParagraph": true, "sentenceId": "a3s18", "text": "Taxing robots and other technical advances, however, will not make the human consequences of automation and robotics go away.", "seen": false}]};
var totalClusterInfo = {"clusterData":[[{"average":0.5,"cluster":0,"sentenceId":"a4s55","phrase":"in moderate agreement"},{"average":-0.3333333333333333,"cluster":0,"sentenceId":"a4s32","phrase":"in moderate disagreement"},{"average":0.5,"cluster":0,"sentenceId":"a1s55","phrase":"in moderate agreement"},{"average":0.8333333333333334,"cluster":0,"sentenceId":"a1s21","phrase":"in strong agreement"},{"average":-0.6666666666666666,"cluster":0,"sentenceId":"a3s15","phrase":"in moderate disagreement"}],[{"average":0,"cluster":1,"sentenceId":"a4s55","phrase":"neutral"},{"average":0,"cluster":1,"sentenceId":"a4s41","phrase":"neutral"},{"average":0,"cluster":1,"sentenceId":"a4s40","phrase":"neutral"},{"average":-0.3333333333333333,"cluster":1,"sentenceId":"a4s27","phrase":"in moderate disagreement"},{"average":0,"cluster":1,"sentenceId":"a4s25","phrase":"neutral"}],[{"average":-0.5,"cluster":2,"sentenceId":"a4s40","phrase":"in moderate disagreement"},{"average":0,"cluster":2,"sentenceId":"a4s27","phrase":"neutral"},{"average":0.25,"cluster":2,"sentenceId":"a4s25","phrase":"in weak agreement"},{"average":0.5,"cluster":2,"sentenceId":"a2s45","phrase":"in moderate agreement"},{"average":0.75,"cluster":2,"sentenceId":"a1s55","phrase":"in strong agreement"}],[{"average":0.25,"cluster":3,"sentenceId":"a4s32","phrase":"in weak agreement"},{"average":0.5,"cluster":3,"sentenceId":"a1s46","phrase":"in moderate agreement"},{"average":0,"cluster":3,"sentenceId":"a1s34","phrase":"neutral"},{"average":-0.25,"cluster":3,"sentenceId":"a1s30","phrase":"in weak disagreement"},{"average":0,"cluster":3,"sentenceId":"a2s18","phrase":"neutral"}]],"extremes":{"yMin":-0.5012789990723624,"xMax":0.5867170129561489,"yMax":0.6841756039985455,"xMin":-0.5220715562703917},"shadeData":[{"cluster":0,"shading":[{"y":-0.1441421105282525,"x":-0.5220715562703917},{"y":-0.3697823555483827,"x":-0.3766614228917927},{"y":-0.3953096049895108,"x":-0.12005938615550224},{"y":-0.2500216908572623,"x":-0.19442428732302652},{"y":0.045556306514005454,"x":-0.3882689819854707},{"y":-0.1441421105282525,"x":-0.5220715562703917}]},{"cluster":1,"shading":[{"y":0.22887569035367122,"x":0.24799967672484496},{"y":0.2593934194553389,"x":0.5867170129561489},{"y":0.33226473195538775,"x":0.3354831091704648},{"y":0.22887569035367122,"x":0.24799967672484496}]},{"cluster":2,"shading":[{"y":0.6841756039985455,"x":-0.3103266877591186},{"y":0.32988976884712085,"x":-0.28141153088113113},{"y":0.2665928548468992,"x":0.035207394017766964},{"y":0.4638843614074746,"x":0.04934027944001254},{"y":0.6841756039985455,"x":-0.3103266877591186}]},{"cluster":3,"shading":[{"y":-0.5012789990723624,"x":0.10166015405304253},{"y":-0.2212672948474511,"x":0.4808719541213589},{"y":-0.09383151087806305,"x":0.3355301552296104},{"y":-0.5012789990723624,"x":0.10166015405304253}]}],"pointData":{"31":{"y":0.2665928548468992,"cluster":2,"x":0.035207394017766964},"34":{"y":0.33226473195538775,"cluster":1,"x":0.3354831091704648},"37":{"y":0.32988976884712085,"cluster":2,"x":-0.28141153088113113},"38":{"y":-0.3953096049895108,"cluster":0,"x":-0.12005938615550224},"39":{"y":-0.2212672948474511,"cluster":3,"x":0.4808719541213589},"40":{"y":-0.5012789990723624,"cluster":3,"x":0.10166015405304253},"41":{"y":0.22887569035367122,"cluster":1,"x":0.24799967672484496},"42":{"y":-0.1441421105282525,"cluster":0,"x":-0.5220715562703917},"43":{"y":0.045556306514005454,"cluster":0,"x":-0.3882689819854707},"44":{"y":-0.3697823555483827,"cluster":0,"x":-0.3766614228917927},"45":{"y":-0.2500216908572623,"cluster":0,"x":-0.19442428732302652},"46":{"y":-0.3658393553041467,"cluster":3,"x":0.2738754177444379},"47":{"y":0.6841756039985455,"cluster":2,"x":-0.3103266877591186},"50":{"y":0.4638843614074746,"cluster":2,"x":0.04934027944001254},"51":{"y":0.2593934194553389,"cluster":1,"x":0.5867170129561489},"10213370026154390":{"y":-0.05534779385182953,"cluster":0,"x":-0.3286277542054012},"10209787576116056":{"y":-0.09383151087806305,"cluster":3,"x":0.3355301552296104}}};
var comments = {"comments":[{"sentenceId":"a3s7","decision":0,"explanation":"Since I dont know that the issues are, I can't really agree or disagree with this sentence.","time":"2017-08-12T22:07:52.000Z"},{"sentenceId":"a1s31","decision":-1,"explanation":"No, it comes from the rational observation that in a world where humans are worse than machines at almost everything, market competition is cruel. ","time":"2017-08-12T22:07:52.000Z"},{"sentenceId":"a2s14","decision":0,"explanation":"The tax would have to be incredibly high for it to make any difference.","time":"2017-08-12T22:07:52.000Z"},{"sentenceId":"a3s15","decision":0,"explanation":"I think in the long run, it'll be beneficial for people.","time":"2017-08-12T22:07:52.000Z"},{"sentenceId":"a3s15","decision":0,"explanation":"Just because this has happened in the past doesn't mean it will continue to happen.","time":"2017-08-12T22:07:52.000Z"},{"sentenceId":"a1s55","decision":1,"explanation":"This is a vacuous stump speech argument. Maybe cite a specific regulation?","time":"2017-08-12T22:07:52.000Z"},{"sentenceId":"a1s55","decision":1,"explanation":"Yes—Too many regulations stifle economic growth.","time":"2017-08-12T22:07:52.000Z"},{"sentenceId":"a3s15","decision":-1,"explanation":"We must remember that the people who lose their jobs are individuals, not just statistics.","time":"2017-08-12T22:07:52.000Z"},{"sentenceId":"a3s7","decision":1,"explanation":"I agree—this is an impossible distinction to make in many cases.","time":"2017-08-12T22:07:52.000Z"},{"sentenceId":"a4s27","decision":0,"explanation":"I think that eventually there will be no jobs that AI isn't good at.","time":"2017-08-12T22:07:52.000Z"},{"sentenceId":"a4s32","decision":1,"explanation":"I like it! We all get to live like retirees.","time":"2017-08-12T22:07:52.000Z"},{"sentenceId":"a1s21","decision":1,"explanation":"dfsafdsa","time":"2017-08-12T22:07:52.000Z"},{"sentenceId":"a3s6","decision":1,"explanation":"","time":"2017-08-24T16:47:59.000Z"},{"sentenceId":"a1s21","decision":-1,"explanation":"","time":"2017-08-24T17:24:18.000Z"},{"sentenceId":"a1s23","decision":-1,"explanation":"","time":"2017-08-24T17:24:40.000Z"},{"sentenceId":"a1s34","decision":1,"explanation":"","time":"2017-08-24T17:26:44.000Z"},{"sentenceId":"a1s46","decision":1,"explanation":"","time":"2017-08-24T17:29:35.000Z"},{"sentenceId":"a1s55","decision":-1,"explanation":"","time":"2017-08-24T17:30:22.000Z"},{"sentenceId":"a2s14","decision":-1,"explanation":"","time":"2017-08-24T17:33:54.000Z"},{"sentenceId":"a2s18","decision":1,"explanation":"","time":"2017-08-24T17:34:46.000Z"},{"sentenceId":"a2s27","decision":1,"explanation":"","time":"2017-08-24T17:36:07.000Z"},{"sentenceId":"a2s45","decision":1,"explanation":"","time":"2017-08-24T17:38:41.000Z"},{"sentenceId":"a3s6","decision":1,"explanation":"The premise is that we tax a behavior to discourage it. Do we really want to become an economic backwater?","time":"2017-08-24T17:28:39.000Z"},{"sentenceId":"a4s25","decision":1,"explanation":"","time":"2017-08-24T17:42:09.000Z"},{"sentenceId":"a4s27","decision":1,"explanation":"","time":"2017-08-24T17:42:26.000Z"},{"sentenceId":"a4s32","decision":1,"explanation":"","time":"2017-08-24T17:43:19.000Z"},{"sentenceId":"a4s40","decision":1,"explanation":"","time":"2017-08-24T17:43:55.000Z"},{"sentenceId":"a4s41","decision":1,"explanation":"","time":"2017-08-24T17:44:16.000Z"},{"sentenceId":"a1s31","decision":0,"explanation":"If the idea is that workers,will save their income as a hedge against future unemployment, just not gonna happen. This sounds like income redistribution in its purest form.","time":"2017-08-24T17:07:23.000Z"},{"sentenceId":"a3s7","decision":0,"explanation":"","time":"2017-08-24T17:17:23.000Z"},{"sentenceId":"a4s41","decision":0,"explanation":"Sounds vastly superior to UNconditional universal basic income...","time":"2017-08-24T17:15:49.000Z"},{"sentenceId":"a4s55","decision":0,"explanation":"Predictions are often inaccurate, especially when they are about the future. But well-reasoned.","time":"2017-08-24T17:17:15.000Z"},{"sentenceId":"a3s12","decision":1,"explanation":"","time":"2017-08-24T17:18:53.000Z"},{"sentenceId":"a3s15","decision":1,"explanation":"","time":"2017-08-24T17:19:41.000Z"},{"sentenceId":"a4s40","decision":0,"explanation":"It is admittedly hard to imagine how free markets would arrive at a resolution. ","time":"2017-08-24T17:21:18.000Z"},{"sentenceId":"a1s21","decision":-1,"explanation":"It's a much more minimalist solution than much of the existing welfare state.","time":"2017-08-24T18:01:48.000Z"},{"sentenceId":"a1s34","decision":-1,"explanation":"If you give people money, they can create opportunities in the present to anticipate economic changes","time":"2017-08-24T18:04:06.000Z"},{"sentenceId":"a2s12","decision":1,"explanation":"Obvy","time":"2017-08-24T18:04:39.000Z"},{"sentenceId":"a2s45","decision":0,"explanation":"It's hard to know","time":"2017-08-24T18:06:16.000Z"},{"sentenceId":"a3s15","decision":-1,"explanation":"The sheer scale of potential job loss makes it incredibly likely that there'd be a large employment shock.","time":"2017-08-24T18:00:44.000Z"},{"sentenceId":"a4s55","decision":0,"explanation":"This is all very speculative...hard to know what will happen in the age of AI, whenever that might be","time":"2017-08-24T18:09:08.000Z"},{"sentenceId":"a4s55","decision":1,"explanation":"","time":"2017-08-24T17:46:22.000Z"}]};
var pageTitle = 'Flipside — Would taxing robots help the people whose jobs they’ll take?';

const path = require('path');
const express = require('express');
const expressVue = require('express-vue');
const bodyParser = require('body-parser');
const mysql = require('mysql');
const morgan = require('morgan');
const async = require('async');
const Sequelize = require('sequelize');
const sendWelcomeEmail = require('./email.js');
const utils = require('./utils.js');
const app = express();

const vueOptions = {
  rootPath: path.join(__dirname, '/views'),
  layout: {
    start: '<body><div id="app">',
    end: '</div></body>'
  }
};

const expressVueMiddleware = expressVue.init(vueOptions);
app.use(expressVueMiddleware);

var dbconfig;
// Try-catch for automatic switching from local dev to RDS
try {
  dbconfig = require('opsworks'); // RDS connection data
} catch (err) {
  dbconfig = {
    db: {
      'host': 'localhost',
      'username': 'root',
      'password': 'root',
      'port': 3306,
      'database': 'prod'
    }
  }
}

// Connect to the Amazon RDS instance
var connection = mysql.createConnection({
  host: dbconfig.db.host,
  user: dbconfig.db.username,
  password: dbconfig.db.password,
  port: dbconfig.db.port,
  database: dbconfig.db.database
});

const sequelize = new Sequelize(dbconfig.db.database, dbconfig.db.username, dbconfig.db.password, {
  host: dbconfig.db.host,
  dialect: 'mysql'
});

sequelize.authenticate()
  .then(() => {
    console.log('Connection has been established successfully.');
  })
  .catch(err => {
    console.error('Unable to connect to the database:', err);
  });

let db = require('./models/models.js').init(sequelize, Sequelize);

sequelize.sync()
  .then(function(err) {
    console.log('Database successfully synced.');
  }, function (err) {
    console.log('An error occurred while creating the table:', err);
  });

// Logs HTTP requests
app.use(morgan('combined'));
// Necessary for Express to parse the body of POST requests
app.use(bodyParser.urlencoded({
  extended: true
}));
// Directs Node to the location of static files
app.use(express.static(path.join(__dirname, 'assets')));

require('./auth.js')(app, connection, db);

// Structure of user object: { id: 14, firstname: 'Forrest', name: 'Forrest Sill' }

app.get('/', function(req, res) {
  console.log(req.user);
  var totalClusterInfo = {};
  var data = {
    pageTitle: pageTitle,
    headercomp: {
      user: req.user
    },
    textcomp: {
      article: {
        title: 'Would taxing robots help the people whose jobs they’ll take?',
        author: 'Yifan Zhang',
        publication: 'The Christian Science Monitor',
        date: 'August 23, 2017',
        text: articleText
      },
      bottomBar: false,
      form: 0,
      responseForm: 0,
      lastReferenced: -1,
      why: 0,
      whyModel: "",
      responseSubmitted: 0,
      lastReferencedResponseForm: -1,
      response: {
        sentenceId: "",
        input: ""
      },
      responses: [],
      whyResponse: {
        sentenceId: "",
        input: ""
      },
      whyResponses: [],
      user: req.user
    },
    mapcomp: {
      // extremeData: totalClusterInfo.extremes,
      // clusterData: totalClusterInfo.clusterData,
      // pointData: totalClusterInfo.pointData,
      // shadeData: totalClusterInfo.shadeData,
      // xlength: totalClusterInfo.extremes.xMax - totalClusterInfo.extremes.xMin,
      // ylength: totalClusterInfo.extremes.yMax - totalClusterInfo.extremes.yMin,
      multiplier: 1,
      groupkey: {
        group: '',
        opinion1: '',
        opinion2: '',
        opinion3: ''
      },
      clusterShowing: 0,
      opinionShowing: 1,
      user: req.user
    },
    commentscomp: {
      showComment: false,
      article: {
        text: articleText
      },
      commentData: comments
    }
  };

  const vue = {
    head: {
      title: pageTitle,
      meta: [{
          property: 'og:title',
          content: pageTitle
        },
        {
          name: 'twitter:title',
          content: pageTitle
        },
        {
          name: 'viewport',
          content: 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no'
        },
        {
          script: 'https://unpkg.com/vue@2.4.2/dist/vue.js'
        },
        {
          script: 'https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js'
        },
        {
          script: 'https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js'
        },
        {
          script: 'https://d3js.org/d3.v4.js'
        },
        {
          script: 'scripts/fb.js'
        },
        {
          script: 'scripts/main.js'
        },
        {
          style: 'https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css'
        },
        {
          style: 'https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css'
        },
        {
          style: 'https://fonts.googleapis.com/css?family=Montserrat:300,400'
        },
        {
          style: 'styles/main.css'
        }
      ]
    }
  };
  // Uncomment this code (and add DB calls)
  //
  // async.parallel([
  //   article: function(callback) {
  //     callback(null, 'article');
  //   },
  //   totalclusterinfo: function(callback) {
  //     callback(null, 'totalclusterinfo');
  //   }
  //   comments: function(callback) {
  //     var query = 'SELECT votes.passage_id AS sentenceId, votes.reaction AS decision, whys.statement AS explanation, whys.time FROM whys INNER JOIN votes ON whys.user_id=votes.user_id AND whys.passage_id=votes.passage_id';
  //     connection.query(query,
  //       function(err, results) {
  //         if (err) {
  //           console.log(err);
  //           callback(err, null);
  //         }
  //         callback(null, results);
  //     });
  //   }
  // ],
  // function(err, results) {
  //   if (err) {
  //     console.log(err);
  //   } else {
  //     data.textcomp.article = results.article;
  //     data.mapcomp.extremeData = results.totalclusterinfo.extremes;
  //     data.mapcomp.clusterData = results.totalclusterinfo.clusterData;
  //     data.mapcomp.pointData = results.totalclusterinfo.pointData;
  //     data.mapcomp.shadeData = results.totalclusterinfo.shadeData;
  //     data.mapcomp.xlength = results.totalClusterInfo.extremes.xMax - results.totalClusterInfo.extremes.xMin;
  //     data.mapcomp.ylength = results.totalClusterInfo.extremes.yMax - results.totalClusterInfo.extremes.yMin;
  //     data.commentscomp.article.text = results.article.text;
  //     data.commentscomp.commentData = results.comments.commentData;
  //
  //     res.renderVue('article', data, vue);
  //   }
  // });

  res.renderVue('article', data, vue);
});

app.post('/contact', function(req, res) {
  res.send("POST request")
  req.checkBody('name', 'Invalid name.').notEmpty().isAlpha();
  req.checkBody('email', 'Email must not be empty.').notEmpty();
  req.checkBody('message', 'Message must not be empty.').notEmpty();

  req.sanitizeBody('name').escape();
  req.sanitizeBody('email').escape();
  req.sanitizeBody('message').escape();

  var contact = {
    name: req.body.name,
    email: req.body.email,
    message: req.body.message
  };

  var errors = req.validationErrors();
  if (errors) {
    console.log(errors);
  } else {
    db.contactUs.create({
      name: contact.name,
      email: contact.email,
      message: contact.message
    });
  }
});

app.post('/emails', function(req, res) {
  req.checkBody('email', 'Email must not be empty.').notEmpty();
  req.sanitizeBody('email').escape();
  req.sanitizeBody('location').escape();

  var signup = {
    email: req.body.email,
    location: req.body.location
  };

  var errors = req.validationErrors();
  if (errors) {
    console.log(errors);
  } else {
    db.email.create({
      email: signup.email,
      location: signup.location
    });
    sendWelcomeEmail("", "", signup.email);
    res.sendStatus(200);
  }
});

app.post('/userStatus', function(req, res) {
  if (req.user) {
    res.send({
      signedIn: true,
      id: req.user.id
    });
  } else {
    res.send({
      signedIn: false,
      id: null
    });
  }
});

app.post('/numVotesCast', function(req, res) {
  db.vote.count({where: {'userId': req.user.id}}).then(count => {
    res.send(count + '');
  });
});

app.post('/submitResponse', function(req, res) {
  utils.upsert(db.vote, {
    userId: req.user.id,
    sentenceId: req.body.sentenceId,
    reaction: req.body.reaction
  }, {
    userId: req.user.id,
    sentenceId: req.body.sentenceId
  });
  res.sendStatus(200);
});

app.post('/submitWhy', function(req, res) {
  db.response.create({
    userId: req.user.id,
    sentenceId: req.body.sentenceId,
    statement: req.body.statement
  });
  res.sendStatus(200);
});

app.post('/getWhys', function(req, res) {

  var query = 'SELECT votes.passage_id AS sentenceId, votes.reaction AS decision, whys.statement AS explanation, whys.time FROM whys INNER JOIN votes ON whys.user_id=votes.user_id AND whys.passage_id=votes.passage_id';
  connection.query(query,
    function(err, results) {
      if (err) {
        console.log(err);
        res.send("error");
      }
      res.send(results);
    });
});

app.get('/terms', function(req, res) {
  res.render('legal/terms/index');
});

app.get('/privacy', function(req, res) {
  res.render('legal/privacy/index');
});

app.listen(process.env.PORT);
console.log('Express server listening on port %d in %s mode.', process.env.PORT, app.settings.env);
